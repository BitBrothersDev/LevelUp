- skill_levels = @skill.skill_levels.includes(:level, :rich_text_notice, :skill_level_items, learning_materials: :skill_level_item)

.page-wrapper
  .container
    .main{ data: { controller: 'skills' } }
      .page-header
        .title-group
          %h1.page-title= @skill.name
          %p.page-subtitle= @skill.skill_category&.name.present? ? "Category Â· #{@skill.skill_category.name}" : 'Skill overview'
        .page-actions
          = link_to 'Back to skills', skills_path, class: 'btn btn-outline-secondary'
          = link_to 'Edit skill', edit_skill_path(@skill), class: 'btn btn-primary'

      - if notice
        .modern-alert{ role: 'alert' }= notice

      .content-card.mb-4
        .d-flex.flex-wrap.gap-3.align-items-center.mb-3
          %span.pill-tag Skill description
          .floating-toolbar
            = check_box_tag :crucial, @skill.crucial, @skill.crucial,
                            data: { id: @skill.id, action: 'skills#toggle' },
                            class: 'mr-2 align-middle bg-gray-50 border-gray-300 focus:ring-3 focus:ring-blue-300 h-5 w-5 rounded checked:bg-green-500'
            %span.mx-2 Self Estimation
            = render 'skills/skill_estimation', skill: @skill
        %p.mb-0= @skill.description.presence || 'No description provided yet.'
        .form-actions.justify-content-end.mt-4
          = button_to 'Destroy this skill', @skill, method: :delete, data: { turbo_confirm: 'Are you sure you want to delete this skill?' }, class: 'btn btn-danger'

      .content-card
        %h2.fs-4.fw-semibold.mb-2 Skill levels
        %p.text-muted.mb-4 Explore requirements, questions, and materials for each level.
        .tab-surface
          %ul#myTab.nav.nav-pills{:role => 'tablist'}
            - skill_levels.each_with_index do |skill_level, i|
              - tab_id = [skill_level.level.title, skill_level.id, 'tab-id'].join('-')
              %li.nav-item{:role => 'presentation'}
                %button.nav-link{ aria: { controls: tab_id, selected: i.zero? }, class: (i.zero? ? 'active' : ''), data: { 'bs-target': "##{tab_id}", 'bs-toggle': 'tab' }, id: [skill_level.level.title, skill_level.id].join('-'), role: 'tab', type: 'button' }= skill_level.level.title
          %div.tab-content#myTabContent
            - skill_levels.each_with_index do |skill_level, i|
              = render 'skills/skill_levels/level', skill_level: skill_level, i: i